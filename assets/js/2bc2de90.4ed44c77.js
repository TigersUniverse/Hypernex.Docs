"use strict";(self.webpackChunkhypernex_docs=self.webpackChunkhypernex_docs||[]).push([[244],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=i.createContext({}),p=function(e){var t=i.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=p(e.components);return i.createElement(d.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=a,k=u["".concat(d,".").concat(c)]||u[c]||m[c]||o;return n?i.createElement(k,r(r({ref:t},s),{},{components:n})):i.createElement(k,r({ref:t},s))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l[u]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},33096:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var i=n(87462),a=(n(67294),n(3905));const o={sidebar_position:2},r="Email Setup",l={unversionedId:"hosting-docs/setup/setupemail",id:"hosting-docs/setup/setupemail",title:"Email Setup",description:"This is heavily based on this guide by Pritthish Nath with some slight adjustments. This guide assumes that you use DigitalOcean as your provider; however, as long as you know how to set up a PTR on your IP and set your hostnames, you'll be fine.",source:"@site/docs/hosting-docs/setup/setupemail.md",sourceDirName:"hosting-docs/setup",slug:"/hosting-docs/setup/setupemail",permalink:"/docs/hosting-docs/setup/setupemail",draft:!1,editUrl:"https://github.com/TigersUniverse/Hypernex.Docs/docs/hosting-docs/setup/setupemail.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"hostingSidebar",previous:{title:"Web Setup",permalink:"/docs/hosting-docs/setup/setupweb"},next:{title:"Setup GameServer",permalink:"/docs/hosting-docs/setup/setupgs"}},d={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"OpenDKIM",id:"opendkim",level:2},{value:"Installing",id:"installing",level:3},{value:"Setting up a DKIM Key",id:"setting-up-a-dkim-key",level:3},{value:"Updating the <code>opendkim.conf</code>",id:"updating-the-opendkimconf",level:3},{value:"Starting OpenDKIM",id:"starting-opendkim",level:3},{value:"Sendmail",id:"sendmail",level:2},{value:"Installing Sendmail",id:"installing-sendmail",level:3},{value:"Configuring Sendmail",id:"configuring-sendmail",level:3},{value:"Adding Records",id:"adding-records",level:2},{value:"SRV",id:"srv",level:3},{value:"DMARC",id:"dmarc",level:3},{value:"DKIM",id:"dkim",level:3},{value:"PTR Record",id:"ptr-record",level:2}],s={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,i.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"email-setup"},"Email Setup"),(0,a.kt)("p",null,"This is heavily based on ",(0,a.kt)("a",{parentName:"p",href:"https://pritthish-nath.medium.com/configuring-spf-dkim-and-dmarc-with-sendmail-on-ubuntu-18-04-41edfd24fdd2"},"this guide by Pritthish Nath")," with some slight adjustments. This guide assumes that you use ",(0,a.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/"},"DigitalOcean")," as your provider; however, as long as you know how to set up a PTR on your IP and set your hostnames, you'll be fine."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A VPS/Server of some kind",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Recommend DigitalOcean"))),(0,a.kt)("li",{parentName:"ul"},"A domain"),(0,a.kt)("li",{parentName:"ul"},"The Domain connected to Cloudflare nameservers and an A record pointed to your server's IP",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Proxy is optional, but recommended"),(0,a.kt)("li",{parentName:"ul"},"Cloudflare isn't required, but is recommended"))),(0,a.kt)("li",{parentName:"ul"},"Correctly configured hosts")),(0,a.kt)("h2",{id:"opendkim"},"OpenDKIM"),(0,a.kt)("p",null,"Installing OpenDKIM can be tricky, especially since it's kinda old, but don't worry, just follow along."),(0,a.kt)("h3",{id:"installing"},"Installing"),(0,a.kt)("p",null,"As root, simply run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"apt-get install opendkim opendkim-tools\n")),(0,a.kt)("h3",{id:"setting-up-a-dkim-key"},"Setting up a DKIM Key"),(0,a.kt)("p",null,"As root, run this code, replacing ",(0,a.kt)("inlineCode",{parentName:"p"},"[DOMAIN]")," with your domain (include subdomain(s)!)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"opendkim-genkey -t -s default -d [DOMAIN]\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Take not of where you ran this command, as a ",(0,a.kt)("inlineCode",{parentName:"p"},"default.txt")," file will be output there, which is needed in a later step")),(0,a.kt)("p",null,"Next, lets move the key somewhere,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"mkdir /etc/opendkim\ncp default.private /etc/opendkim/\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"If any service asks, your Selector is ",(0,a.kt)("inlineCode",{parentName:"p"},"default"))),(0,a.kt)("p",null,"Now, we need to give it the correct permissions"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chmod -R ugo-w /etc/opendkim\nchown -R root /etc/opendkim\n")),(0,a.kt)("h3",{id:"updating-the-opendkimconf"},"Updating the ",(0,a.kt)("inlineCode",{parentName:"h3"},"opendkim.conf")),(0,a.kt)("p",null,"Open the OpenDKIM config file at ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/opendkim.conf")," with a preferred text editor. I'm using ",(0,a.kt)("inlineCode",{parentName:"p"},"nano"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"nano /etc/opendkim.conf\n")),(0,a.kt)("p",null,"Then, replace the following values with these lines,"),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Do not have multiple keys! If there is already a socket, either remove it, or comment out the line with a ",(0,a.kt)("inlineCode",{parentName:"p"},"#"))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Domain [DOMAIN]")," (include subdomain(s))\n",(0,a.kt)("inlineCode",{parentName:"p"},"KeyFile /etc/opendkim/default.private"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Selector default"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"Socket inet:8891@[SUBDOMAIN/DOMAIN]")," (If your domain is something like ",(0,a.kt)("inlineCode",{parentName:"p"},"play.hypernex.dev"),", then you would input ",(0,a.kt)("inlineCode",{parentName:"p"},"play"),", otherwise, just ",(0,a.kt)("inlineCode",{parentName:"p"},"hypernex"),". Should be a hostname)"),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Take note of your Socket value, as we will need it later")),(0,a.kt)("h3",{id:"starting-opendkim"},"Starting OpenDKIM"),(0,a.kt)("p",null,"Finally, start the OpenDKIM service"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"systemctl start opendkim\n")),(0,a.kt)("p",null,"If something does not work, look for the Error status in the systemd logs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"systemctl status opendkim\n")),(0,a.kt)("h2",{id:"sendmail"},"Sendmail"),(0,a.kt)("p",null,"Hypernex uses Sendmail, the same as php's ",(0,a.kt)("inlineCode",{parentName:"p"},"mail()")," function, to send emails. This setup is fairly easy."),(0,a.kt)("h3",{id:"installing-sendmail"},"Installing Sendmail"),(0,a.kt)("p",null,"Run this command,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"apt install sendmail\n")),(0,a.kt)("h3",{id:"configuring-sendmail"},"Configuring Sendmail"),(0,a.kt)("p",null,"Open the Sendmail config file at ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/mail/sendmail.mc")," with a preferred text editor. I'm still using ",(0,a.kt)("inlineCode",{parentName:"p"},"nano"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"nano /etc/mail/sendmail.mc\n")),(0,a.kt)("p",null,"Next, add this line to the bottom, replacing the ","[SOCKET]"," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"Socket")," value done in the OpenDKIM configuration step from earlier."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"INPUT_MAIL_FILTER(`opendkim', `S=[SOCKET]')\n")),(0,a.kt)("p",null,"Finally, save and recompile Sendmail"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"sudo -i\ncd /etc/mail\nm4 sendmail.mc > sendmail.cf\nsystemctl restart sendmail\n")),(0,a.kt)("h2",{id:"adding-records"},"Adding Records"),(0,a.kt)("p",null,"Navigate to your Cloudflare dashboard, and select the domain you will be working with, then navigate to the DNS tab."),(0,a.kt)("h3",{id:"srv"},"SRV"),(0,a.kt)("p",null,"Add a new TXT record for your domain/subdomain, and input the following text, replacing ","[DOMAIN]"," with your domain (including subdomain)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"v=spf1 a:[DOMAIN] -all\n")),(0,a.kt)("p",null,"Set TTL to Auto and save."),(0,a.kt)("h3",{id:"dmarc"},"DMARC"),(0,a.kt)("p",null,"Add a new TXT record with the following key ",(0,a.kt)("inlineCode",{parentName:"p"},"_dmarc.[SUBDOMAIN, IF APPLICABLE]"),", and input the following text"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"v=DMARC1; p=reject; sp=reject;\n")),(0,a.kt)("h3",{id:"dkim"},"DKIM"),(0,a.kt)("p",null,"Add a new TXT record with the following key ",(0,a.kt)("inlineCode",{parentName:"p"},"default._domainkey.[SUBDOMAIN, IF APPLICABLE]"),", and input text from your ",(0,a.kt)("inlineCode",{parentName:"p"},"default.txt")," file from earlier."),(0,a.kt)("p",null,"Assuming your ",(0,a.kt)("inlineCode",{parentName:"p"},"default.txt")," file looked like this,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'default._domainkey      IN      TXT     ( "v=DKIM1; h=sha256; k=rsa; t=y; "\n          "p=0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n          0000000000000000000000000000000000000000000000000000000000000000"\n          "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" )  ; ----- DKIM key default for play.hypernex.dev\n')),(0,a.kt)("p",null,"The text would be this,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"v=DKIM1; h=sha256; k=rsa; t=y; p=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n")),(0,a.kt)("h2",{id:"ptr-record"},"PTR Record"),(0,a.kt)("p",null,"Assuming you used DigitalOcean, all you need to do is set your droplet's name to your domain, then reboot your droplet (assuming you changed the name). If you did not use DigitalOcean, please check with your provider on how to set a PTR record for your shared/dedicated IP address."))}m.isMDXComponent=!0}}]);